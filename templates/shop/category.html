{% extends "shop/base.html" %}
{% load static %}

{% block title %}Category Products{% endblock %}

{% block content %}

<div class="container">

    <h2 class="section-title">
        {{ category.name|default:"Products" }}
    </h2>

    <section class="product-grid">
        {% for p in products %}
            <article class="product-card {% if not p.available %}out-of-stock{% endif %}">

                <!-- PRODUCT IMAGE -->
                <a href="{% if p.available %}{% url 'product_detail' p.id %}{% else %}#{% endif %}">
                    {% if p.image %}
                        <img src="{{ p.image.url }}" alt="{{ p.name }}">
                    {% else %}
                        <img src="{% static 'shop/images/placeholder.svg' %}" alt="No image">
                    {% endif %}
                </a>

                <!-- PRODUCT INFO -->
                <div class="meta">
                    <h3>{{ p.name }}</h3>

                    <p class="description">
                        {{ p.description|truncatechars:60|default:"No description available" }}
                    </p>

                    <p class="price">₹ {{ p.price }}</p>

                    {% if p.available %}
                        <p class="availability in-stock">✔ In Stock</p>

                        <form action="{% url 'cart_add' p.id %}" method="post">
                            {% csrf_token %}
                            <button class="btn small">Add to Cart</button>
                        </form>
                    {% else %}
                        <p class="availability out-of-stock">✖ Out of Stock</p>
                    {% endif %}
                </div>

            </article>
        {% empty %}
            <p>No products found in this category.</p>
        {% endfor %}
    </section>

</div>

{% endblock %}
