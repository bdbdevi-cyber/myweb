{% extends "shop/base.html" %}
{% load static %}

{% block title %}Category Products{% endblock %}

{% block content %}

<div class="container">

    <h2 class="section-title">
        {{ category_name|default:"Products" }}
    </h2>

    <section class="product-grid">
        {% for p in products %}
            <article class="product-card {% if not p.available %}out-of-stock{% endif %}">

                <!-- PRODUCT IMAGE (CLICKABLE ‚Üí PRODUCT DETAIL PAGE) -->
                <div class="product-image">
                    <a href="{% url 'product_detail' p.id %}">
                        {% if p.image %}
                            <img src="{{ p.image.url }}" alt="{{ p.name }}">
                        {% else %}
                            <img src="{% static 'shop/images/placeholder.svg' %}" alt="No image">
                        {% endif %}
                    </a>
                </div>

                <!-- WISHLIST ICON -->
                <div class="wishlist-icon">
                    {% if user.is_authenticated %}
                        {% if p.id in wishlist_items %}
                            <a href="{% url 'wishlist_remove' p.id %}">‚ù§Ô∏è</a>
                        {% else %}
                            <a href="{% url 'wishlist_add' p.id %}">ü§ç</a>
                        {% endif %}
                    {% else %}
                        <a href="{% url 'login' %}">ü§ç</a>
                    {% endif %}
                </div>

                <!-- PRODUCT INFO -->
                <div class="meta">
                    <h3>{{ p.name }}</h3>

                    <p class="price">‚Çπ {{ p.price }}</p>

                    {% if p.available %}
                        <p class="availability in-stock">‚úî In Stock</p>

                        <form action="{% url 'cart_add' p.id %}" method="post">
                            {% csrf_token %}
                            <button class="btn small">Add to Cart</button>
                        </form>
                    {% else %}
                        <p class="availability out-of-stock">‚úñ Out of Stock</p>
                    {% endif %}
                </div>

            </article>
        {% empty %}
            <p>No products found in this category.</p>
        {% endfor %}
    </section>

</div>

{% endblock %}
